<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¡°í•© ê²Œì„: ã…‹ + ã… = ì¹´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{
      margin:0;
      font-family: system-ui, -apple-system, sans-serif;
      background:#0b0d12;
      color:#fff;
      text-align:center;
      padding:20px;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }
    h1{ margin:0 0 8px; font-size:22px; }
    .hint{ color:#a9b4c7; font-size:14px; margin:0 0 16px; }

    .topRow{
      display:flex;
      gap:14px;
      justify-content:center;
      flex-wrap:wrap;
      margin: 10px 0 18px;
    }

    .card{
      width:140px;
      height:120px;
      border-radius:18px;
      border:1px solid #242b3c;
      background:#151a25;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      position:relative;
      cursor:pointer;
    }
    .big{
      font-size:56px;
      font-weight:900;
      line-height:1;
    }
    .small{
      margin-top:6px;
      font-size:13px;
      color:#a9b4c7;
    }

    .target{
      margin: 8px auto 18px;
      padding: 12px 14px;
      max-width: 520px;
      border-radius: 14px;
      background:#101523;
      border:1px solid #242b3c;
    }
    .target b{ font-size:18px; }

    .slots{
      display:flex;
      gap:14px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      margin: 6px 0 10px;
    }
    .slot{
      width:160px;
      height:110px;
      border-radius:18px;
      border:2px dashed #3a4764;
      background:#0f1422;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .slot.filled{
      border-style:solid;
      border-color:#22c55e;
      background:#0f1a16;
    }
    .slotLabel{
      position:absolute;
      top:10px;
      left:12px;
      font-size:12px;
      color:#a9b4c7;
    }
    .slotValue{
      font-size:54px;
      font-weight:900;
    }
    .arrow{
      font-size:24px;
      color:#a9b4c7;
      margin:0 6px;
    }
    .resultBox{
      min-width: 130px;
      height:110px;
      border-radius:18px;
      border:1px solid #242b3c;
      background:#121725;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:54px;
      font-weight:900;
    }

    .controls{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 14px;
    }
    .btn{
      padding:12px 16px;
      font-size:15px;
      border-radius:12px;
      border:none;
      cursor:pointer;
      background:#2563eb;
      color:#fff;
    }
    .btn.gray{ background:#2a3347; }

    #msg{
      min-height:28px;
      margin-top:12px;
      font-size:18px;
    }

    /* ë“œë˜ê·¸ ì¤‘ ë”°ë¼ë‹¤ë‹ˆëŠ” ìœ ë ¹(ghost) */
    .ghost{
      position:fixed;
      left:0; top:0;
      transform: translate(-9999px, -9999px);
      width:110px;
      height:100px;
      border-radius:18px;
      border:1px solid #242b3c;
      background:#151a25;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:54px;
      font-weight:900;
      pointer-events:none;
      z-index:9999;
      opacity:0.95;
    }

    /* íŒì—… */
    #popup{
      position:fixed;
      left:0; top:0;
      width:100%; height:100%;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.6);
      z-index:10000;
    }
    #popup img{
      width:240px;
      max-width:70%;
    }
  </style>
</head>
<body>
  <h1>ì¡°í•© ê²Œì„</h1>
  <p class="hint">ì¹´ë“œë¥¼ <b>ë“œë˜ê·¸</b>í•´ì„œ ë¹ˆì¹¸ì— ë„£ê±°ë‚˜, ì¹´ë“œë¥¼ <b>í†¡</b> ëˆŒëŸ¬ì„œ ë„£ì–´ë„ ë¼ìš”.</p>

  <div class="topRow">
    <div class="card" data-key="k" data-char="ã…‹">
      <div class="big">ã…‹</div>
      <div class="small">ëˆŒëŸ¬ì„œ ì†Œë¦¬</div>
    </div>
    <div class="card" data-key="a" data-char="ã…">
      <div class="big">ã…</div>
      <div class="small">ëˆŒëŸ¬ì„œ ì†Œë¦¬</div>
    </div>
  </div>

  <div class="target">
    ì˜¤ëŠ˜ì˜ ë‹¨ì–´: <b>ì¹´</b> (ã…‹ + ã…)
  </div>

  <div class="slots">
    <div class="slot" id="slotC">
      <div class="slotLabel">ììŒ</div>
      <div class="slotValue" id="valC"></div>
    </div>

    <div class="slot" id="slotV">
      <div class="slotLabel">ëª¨ìŒ</div>
      <div class="slotValue" id="valV"></div>
    </div>

    <div class="arrow">â†’</div>

    <div class="resultBox" id="resultBox">?</div>
  </div>

  <div class="controls">
    <button class="btn gray" onclick="resetSlots()">ë‹¤ì‹œí•˜ê¸°</button>
    <button class="btn" onclick="playTarget()">ğŸ”Š ì¹´ ì†Œë¦¬ ë“£ê¸°</button>
  </div>

  <div id="msg"></div>

  <audio id="player"></audio>
  <div class="ghost" id="ghost"></div>

  <!-- íŒì—…: ë„ˆê°€ ë‚˜ì¤‘ì— ì´ë¯¸ì§€ ì˜¬ë¦¬ë©´ ì‚¬ìš© ê°€ëŠ¥ -->
  <div id="popup" onclick="hidePopup()">
    <img id="popupImg" src="" alt="">
  </div>

  <script>
    // âœ… ì˜¤ë””ì˜¤ ê²½ë¡œ (ê³µìš©)
    const sounds = {
      k: "audio/k.m4a",
      a: "audio/a.m4a",
      ka: "audio/ka.m4a"
    };

    // âœ… ëª©í‘œ(ì¼ë‹¨ 1ê°œ: ì¹´). ë‚˜ì¤‘ì— ë°°ì—´ë¡œ í™•ì¥ ê°€ëŠ¥.
    const target = { word: "ì¹´", c: "k", v: "a", sound: "ka" };

    const audio = document.getElementById("player");
    const msg = document.getElementById("msg");
    const resultBox = document.getElementById("resultBox");

    const slotC = document.getElementById("slotC");
    const slotV = document.getElementById("slotV");
    const valC = document.getElementById("valC");
    const valV = document.getElementById("valV");

    const ghost = document.getElementById("ghost");

    let filledC = null;
    let filledV = null;

    // íŒì—…(ì´ë¯¸ì§€) â€” ë‚˜ì¤‘ì— images/correct.png, images/wrong.png ì˜¬ë¦¬ë©´ ì‚¬ìš©
    const popup = document.getElementById("popup");
    const popupImg = document.getElementById("popupImg");
    function showPopup(kind){
      // kind: "correct" | "wrong"
      // ì´ë¯¸ì§€ ì—†ìœ¼ë©´ ê·¸ëƒ¥ í…ìŠ¤íŠ¸ë§Œ ë³´ì—¬ë„ ë˜ê²Œ ì²˜ë¦¬
      const path = kind === "correct" ? "images/correct.png" : "images/wrong.png";
      popupImg.src = path;
      popup.style.display = "flex";
      // 1ì´ˆ ë’¤ ìë™ ë‹«ê¸° (í„°ì¹˜í•´ë„ ë‹«í˜)
      setTimeout(hidePopup, 900);
    }
    function hidePopup(){ popup.style.display = "none"; }

    function play(src){
      audio.pause();
      audio.currentTime = 0;
      audio.src = src;
      audio.play().catch(()=>{});
    }
    function playTarget(){ play(sounds[target.sound]); }

    function setSlot(which, key, char){
      if(which === "c"){
        filledC = key;
        valC.textContent = char;
        slotC.classList.add("filled");
      } else {
        filledV = key;
        valV.textContent = char;
        slotV.classList.add("filled");
      }
      checkAnswer();
    }

    function resetSlots(){
      filledC = null; filledV = null;
      valC.textContent = ""; valV.textContent = "";
      slotC.classList.remove("filled");
      slotV.classList.remove("filled");
      resultBox.textContent = "?";
      msg.textContent = "";
    }

    function checkAnswer(){
      if(!filledC || !filledV){
        resultBox.textContent = "?";
        msg.textContent = "";
        return;
      }

      // ê²°ê³¼ í‘œì‹œ(í˜„ì¬ëŠ” ëª©í‘œê°€ ì¹´ 1ê°œë¼ì„œ ë‹¨ìˆœ)
      if(filledC === target.c && filledV === target.v){
        resultBox.textContent = target.word;
        msg.textContent = "ğŸ‰ ì •ë‹µ!";
        playTarget();
        // ì •ë‹µ íŒì—…(ì´ë¯¸ì§€) â€” ì´ë¯¸ì§€ ì˜¬ë¦¬ë©´ ë³´ì„
        showPopup("correct");
      } else {
        resultBox.textContent = "Ã—";
        msg.textContent = "âŒ ë‹¤ì‹œ í•´ë³¼ê¹Œ?";
        showPopup("wrong");
      }
    }

    // âœ… íƒ­ìœ¼ë¡œ ë„£ê¸°(ëŒ€ì²´ ì…ë ¥): ì¹´ë“œ ëˆŒë €ì„ ë•Œ ë¹ˆì¹¸ì— ìˆœì„œëŒ€ë¡œ ë“¤ì–´ê°€ê²Œ
    function tapInsert(key, char){
      // ë¨¼ì € ììŒ ì¹¸ì´ ë¹„ë©´ ê±°ê¸°ì—, ì•„ë‹ˆë©´ ëª¨ìŒ ì¹¸ì—
      if(!filledC){
        setSlot("c", key, char);
      } else if(!filledV){
        setSlot("v", key, char);
      } else {
        // ë‘˜ ë‹¤ ì°¼ìœ¼ë©´: ë‹¤ì‹œí•˜ê¸° í›„ ì²« ì¹¸ë¶€í„°
        resetSlots();
        setSlot("c", key, char);
      }
    }

    // âœ… ì»¤ìŠ¤í…€ ë“œë˜ê·¸: Pointer Events (PC/ì•„ì´í°/ì•„ì´íŒ¨ë“œ/ê°¤íƒ­ ëª¨ë‘)
    let dragging = null; // { key, char }
    let pointerDownPos = null;
    let didDrag = false;

    function onPointerDown(e){
      const card = e.currentTarget;
      const key = card.dataset.key;
      const char = card.dataset.char;

      // í´ë¦­í•˜ë©´ ì†Œë¦¬(í•­ìƒ)
      play(sounds[key]);

      dragging = { key, char };
      pointerDownPos = { x: e.clientX, y: e.clientY };
      didDrag = false;

      // ë“œë˜ê·¸ ìœ ë ¹ ì¤€ë¹„
      ghost.textContent = char;
      ghost.style.transform = `translate(${e.clientX - 55}px, ${e.clientY - 55}px)`;

      // ìº¡ì²˜ë¡œ ì´ë™ ì¶”ì 
      card.setPointerCapture(e.pointerId);
    }

    function onPointerMove(e){
      if(!dragging) return;
      const dx = Math.abs(e.clientX - pointerDownPos.x);
      const dy = Math.abs(e.clientY - pointerDownPos.y);

      // ì¡°ê¸ˆ ì›€ì§ì´ë©´ ë“œë˜ê·¸ë¡œ íŒë‹¨
      if(dx + dy > 8) didDrag = true;

      if(didDrag){
        ghost.style.transform = `translate(${e.clientX - 55}px, ${e.clientY - 55}px)`;
      }
    }

    function onPointerUp(e){
      if(!dragging) return;

      // ë“œë˜ê·¸ë¥¼ ì‹¤ì œë¡œ í–ˆì„ ë•Œë§Œ drop íŒì •
      if(didDrag){
        const dropTarget = document.elementFromPoint(e.clientX, e.clientY);
        const droppedOnC = dropTarget && (dropTarget.id === "slotC" || dropTarget.closest("#slotC"));
        const droppedOnV = dropTarget && (dropTarget.id === "slotV" || dropTarget.closest("#slotV"));

        if(droppedOnC) setSlot("c", dragging.key, dragging.char);
        else if(droppedOnV) setSlot("v", dragging.key, dragging.char);
      } else {
        // ë“œë˜ê·¸ ì•ˆ í–ˆìœ¼ë©´ íƒ­ ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬
        tapInsert(dragging.key, dragging.char);
      }

      // ìœ ë ¹ ìˆ¨ê¸°ê¸°
      ghost.style.transform = `translate(-9999px, -9999px)`;
      dragging = null;
      pointerDownPos = null;
      didDrag = false;
    }

    // ì¹´ë“œ ì´ë²¤íŠ¸ ì—°ê²°
    document.querySelectorAll(".card").forEach(card=>{
      card.addEventListener("pointerdown", onPointerDown);
      card.addEventListener("pointermove", onPointerMove);
      card.addEventListener("pointerup", onPointerUp);
      card.addEventListener("pointercancel", onPointerUp);
    });
  </script>
</body>
</html>
